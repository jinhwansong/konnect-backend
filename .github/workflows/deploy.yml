- name: Deploy on EC2
  uses: appleboy/ssh-action@master
  with:
    script: |
      # 배포 디렉토리 준비
      mkdir -p ~/konnect-backend
      cd ~/deployment
      unzip -o deployment.zip -d ~/konnect-backend

      # 이후 모든 경로를 ~/konnect-backend로 변경
      cd ~/konnect-backend
      
      # Node.js 및 npm 설정
      export NVM_DIR=~/.nvm
      source ~/.nvm/nvm.sh
      
      # pm2 설치
      npm install -g pm2
      
      # 의존성 설치
      npm ci --omit=dev
      
      # 애플리케이션 재시작
      pm2 delete konnect-backend || true
      pm2 start npm --name "konnect-backend" -- run start:prod

      echo "Deployment completed successfully!"
